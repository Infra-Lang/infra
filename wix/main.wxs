<?xml version="1.0" ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product
        Id="*"
        Name="Infra Programming Language"
        Language="1033"
        Version="1.0.0"
        Manufacturer="Infra-Lang Contributors"
        UpgradeCode="A4B2C3D1-E5F6-7890-ABCD-EF1234567890"
    >

    <Package
            InstallerVersion="500"
            Compressed="yes"
            InstallScope="perMachine"
            Description="Infra Programming Language Installer"
            Comments="A simple, Python-like programming language built for performance and competitive programming"
            Platform="x64"
        />

    <!-- Python-style upgrade handling -->
    <MajorUpgrade
            DowngradeErrorMessage="A newer version of Infra is already installed."
        />

    <MediaTemplate EmbedCab="yes" />

    <!-- Default installation directory like Python -->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    <Property Id="INSTALLFOLDER">
      <RegistrySearch
                Id="InfraDirSearch"
                Root="HKLM"
                Key="SOFTWARE\Infra-Lang\Infra"
                Name="InstallPath"
                Type="directory"
            />
    </Property>

    <!-- Custom properties for installation options -->
    <Property Id="ADD_TO_PATH" Value="1" />
    <Property Id="CREATE_SHORTCUTS" Value="1" />
    <Property Id="ASSOCIATE_FILES" Value="1" />
    <Property Id="INSTALL_DESKTOP_SHORTCUT" Value="0" />

    <!-- Installation directory structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLFOLDER" Name="Infra" />
      </Directory>

      <!-- Start Menu Programs directory -->
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="Infra" />
      </Directory>

      <!-- Desktop directory for optional shortcut -->
      <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>

    <!-- Main installation components -->
    <DirectoryRef Id="INSTALLFOLDER">
      <Component
                Id="MainExecutable"
                Guid="12345678-1234-5678-9ABC-123456789ABC"
            >
        <File
                    Id="InfraExe"
                    Source="$(var.CargoTargetBinDir)/infra.exe"
                    KeyPath="yes"
                />

        <!-- REPL shortcut (created conditionally) -->
        <Shortcut
                    Id="InfraREPLShortcut"
                    Directory="ApplicationProgramsFolder"
                    Name="Infra REPL"
                    Description="Infra Programming Language Interactive Shell"
                    Target="[#InfraExe]"
                    WorkingDirectory="INSTALLFOLDER"
                    Arguments="--repl"
                    Icon="InfraIcon.exe"
                />

        <!-- CreateFolder for ApplicationProgramsFolder shortcut -->
        <CreateFolder Directory="ApplicationProgramsFolder" />

        <!-- Desktop shortcut (created conditionally) -->
        <Shortcut
                    Id="InfraDesktopShortcut"
                    Directory="DesktopFolder"
                    Name="Infra REPL"
                    Description="Infra Programming Language Interactive Shell"
                    Target="[#InfraExe]"
                    WorkingDirectory="INSTALLFOLDER"
                    Arguments="--repl"
                    Icon="InfraIcon.exe"
                />

        <!-- CreateFolder for Desktop Folder shortcut -->
        <CreateFolder Directory="DesktopFolder" />

        <!-- File association registry entries -->

        <!-- .if file extension registration -->
        <RegistryKey
                    Root="HKCR"
                    Key=".if"
                    ForceCreateOnInstall="yes"
                    ForceDeleteOnUninstall="yes"
                >
            <RegistryValue Type="string" Value="Infra.File" />
            <RegistryValue
                        Name="Content Type"
                        Type="string"
                        Value="text/plain"
                    />
            <RegistryValue Name="PerceivedType" Type="string" Value="text" />
        </RegistryKey>

        <!-- Infra.File registration -->
        <RegistryKey
                    Root="HKCR"
                    Key="Infra.File"
                    ForceCreateOnInstall="yes"
                    ForceDeleteOnUninstall="yes"
                >
            <RegistryValue Type="string" Value="Infra Source File" />
            <RegistryKey Key="DefaultIcon">
                <RegistryValue Type="string" Value="[#InfraExe],0" />
            </RegistryKey>
            <RegistryKey Key="shell\open\command">
                <RegistryValue
                            Type="string"
                            Value="&quot;[#InfraExe]&quot; &quot;%1&quot;"
                        />
            </RegistryKey>
            <RegistryKey Key="shell\edit\command">
                <RegistryValue
                            Type="string"
                            Value="notepad.exe &quot;%1&quot;"
                        />
            </RegistryKey>
        </RegistryKey>
      </Component>



      <!-- Documentation component -->
      <Component Id="Documentation" Guid="DEADBEEF-DEAD-BEEF-DEAD-DEADBEEFDEAD">
        <File Id="ReadmeFile" Source="README.md" />
        <File Id="LicenseFile" Source="LICENSE" KeyPath="yes" />
      </Component>
    </DirectoryRef>







    <!-- Enhanced feature tree -->
    <Feature
            Id="Complete"
            Title="Infra Programming Language"
            Description="The complete Infra programming language package."
            Display="expand"
            ConfigurableDirectory="INSTALLFOLDER"
            Level="1"
        >

        <Feature
                Id="MainProgram"
                Title="Infra Core Files"
                Description="Infra programming language interpreter, compiler, and core libraries."
                Level="1"
                Display="expand"
            >
            <ComponentRef Id="MainExecutable" />
        </Feature>



        <Feature
                Id="DocumentationFeature"
                Title="Documentation"
                Description="README file and license information."
                Level="1"
            >
            <ComponentRef Id="Documentation" />
        </Feature>

        <!-- Shortcuts are now part of MainExecutable and Documentation components -->

        <!-- File associations are now part of MainExecutable component -->

        <!-- Desktop shortcut is now part of MainExecutable component -->
    </Feature>

    <!-- Python-style UI with advanced features -->
    <UIRef Id="WixUI_Mondo" />

    <!-- Custom properties for better UI experience -->
    <Property
            Id="ARPURLINFOABOUT"
            Value="https://github.com/Infra-Lang/infra"
        />
    <Property
            Id="ARPAUTHORIZEDCDFPREFIX"
            Value="https://github.com/Infra-Lang/infra/releases"
        />
    <Property Id="ARPSIZE" Value="50000" />
    <Property
            Id="ARPHELPLINK"
            Value="https://github.com/Infra-Lang/infra/discussions"
        />
    <Property
            Id="ARPUPDATEURL"
            Value="https://github.com/Infra-Lang/infra/releases"
        />

    <!-- Icon definition -->
    <Icon Id="InfraIcon.exe" SourceFile="$(var.CargoTargetBinDir)/infra.exe" />
    <Property Id="ARPPRODUCTICON" Value="InfraIcon.exe" />

  </Product>
</Wix>
